<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Bio — NguyenTrongg</title>

  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@500;700;900&family=Poppins:wght@300;400;600;800&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r121/three.min.js"></script>

  <style>
    :root{
      --bg:#05060a;
      --accentA: #7c3aed;
      --accentB: #06b6d4;
      --purple-main: #9b5cff;
      --purple-deep: #5b1bd9;
      --max-width: 980px;
    }
    *{box-sizing:border-box;margin:0;padding:0}
    html,body{height:100%;}
    body{
      font-family:'Poppins',sans-serif;
      background:var(--bg);
      color:#fff;
      overflow:hidden;
    }
    #vanta-bg { position:fixed; inset:0; z-index:0; pointer-events:none; }
    .overlay { position:fixed; inset:0; z-index:1; pointer-events:none; background: linear-gradient(180deg, rgba(0,0,0,0.12), rgba(0,0,0,0.32)); mix-blend-mode: overlay; }

    .wave-layer { position:fixed; inset:0; z-index:9; pointer-events:none; overflow:visible; perspective:1200px; }
    .wave { position:absolute; width:160px; height:160px; border-radius:50%; transform-origin:center; background: radial-gradient(circle at 40% 40%, rgba(155,92,255,0.85), rgba(91,27,217,0.35) 40%, rgba(91,27,217,0.12) 60%, transparent 70%); filter: blur(8px) saturate(1.2); mix-blend-mode: screen; pointer-events:none; will-change: transform, opacity; animation: waveExpand 1000ms cubic-bezier(.2,.9,.3,1) forwards; box-shadow: 0 30px 80px rgba(91,27,217,0.22), inset 0 -6px 30px rgba(255,255,255,0.04); }
    @keyframes waveExpand{ 0%{ transform: translate3d(-50%,-50%,0) scale(.28) rotateX(18deg); opacity:0.95 } 60%{ transform: translate3d(-50%,-50%,-140px) scale(1.6) rotateX(8deg); opacity:0.52 } 100%{ transform: translate3d(-50%,-50%,-360px) scale(3.6) rotateX(0deg); opacity:0 } }

    .enter-screen{ position:fixed; inset:0; z-index:12; display:flex; align-items:center; justify-content:center; flex-direction:column; gap:18px; background:linear-gradient(180deg, rgba(2,6,23,0.85), rgba(0,0,0,0.9)); backdrop-filter: blur(6px); }
    .logo{ font-family:'Montserrat',sans-serif; font-size:42px; font-weight:900; letter-spacing:2px; background:linear-gradient(90deg,var(--accentA),var(--accentB)); -webkit-background-clip:text;color:transparent; text-shadow: 0 6px 30px rgba(0,0,0,0.6); }
    .enter-btn{ padding:14px 36px; border-radius:999px; border:none; cursor:pointer; background:linear-gradient(90deg,#ffd54a,#ffb300); color:#0f0f10; font-weight:800; font-size:16px; box-shadow:0 10px 40px rgba(255,181,0,0.12), 0 6px 18px rgba(0,0,0,0.6); transform-origin:center; }

    .wrap { position:relative; z-index:2; min-height:100vh; display:flex; align-items:center; justify-content:center; padding:48px 20px; }
    .card { width:min(95%, var(--max-width)); background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); border-radius:20px; padding:28px; box-shadow: 0 30px 90px rgba(2,6,23,0.7); display:flex; gap:26px; align-items:center; backdrop-filter: blur(8px); border: 1px solid rgba(255,255,255,0.03); position:relative; overflow:hidden; }

    .left { width:320px; min-width:220px; display:flex; flex-direction:column; align-items:center; gap:18px; position:relative; }
    .avatar-wrap { position:relative; width:220px; height:220px; border-radius:999px; display:flex; align-items:center; justify-content:center; transform-style:preserve-3d; transition: transform 200ms ease; cursor:pointer; z-index:3; }
    .avatar-ring { position:absolute; inset:-12px; border-radius:999px; background: conic-gradient(from 0deg, var(--accentA), var(--accentB), #8b5cf6, #06b6d4, var(--accentA)); filter: blur(10px); opacity:0.95; z-index:1; animation: ringRotate 8s linear infinite; pointer-events:none; box-shadow: 0 30px 60px rgba(6,26,37,0.45); border:1px solid rgba(255,255,255,0.02); }
    @keyframes ringRotate { to { transform: rotate(360deg); } }
    .avatar-halo { position:absolute; inset:6px; border-radius:999px; z-index:2; background: radial-gradient(circle at 30% 20%, rgba(124,58,237,0.28), rgba(6,182,212,0.12) 30%, transparent 60%); filter: blur(14px); pointer-events:none; }

    .avatar { width:200px; height:200px; border-radius:999px; overflow:hidden; border: 3px solid rgba(255,255,255,0.06); z-index:3; background:#111; transform: translateZ(40px); box-shadow: 0 20px 60px rgba(6,26,37,0.6), 0 0 30px rgba(124,58,237,0.06); position:relative; display:flex; align-items:center; justify-content:center; }
    .avatar img { width:100%; height:100%; object-fit:cover; display:block; }
    .badge { position:absolute; right:-6px; top:-6px; z-index:6; background: linear-gradient(90deg,var(--accentA),var(--accentB)); color:white; font-weight:800; font-size:12px; padding:6px 10px; border-radius:999px; box-shadow:0 8px 30px rgba(7,16,38,0.6); transform: translateZ(60px); border:1px solid rgba(255,255,255,0.06); }

    .right { flex:1; display:flex; flex-direction:column; gap:10px; padding:6px 12px; min-width:220px; }
    .username { font-family:'Montserrat',sans-serif; font-size:48px; font-weight:900; color:transparent; transform-style:preserve-3d; perspective:900px; display:inline-block; min-height:64px; }
    .username .letter { display:inline-block; font-weight:900; font-size:inherit; transform-style:preserve-3d; will-change: transform, text-shadow, opacity; transition: transform 420ms cubic-bezier(.2,.9,.3,1), text-shadow 420ms ease, opacity 420ms ease; margin:0 1px; color:var(--purple-main); background: linear-gradient(180deg, var(--purple-main), var(--purple-deep)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; text-shadow: 0 6px 18px rgba(91,27,217,0.24); transform: translateZ(22px); opacity:0; }
    .username .letter.in { animation: letterIn 900ms cubic-bezier(.2,.9,.3,1) forwards; }
    @keyframes letterIn { 0% { transform: translateY(24px) translateZ(6px) rotateX(6deg); opacity:0; filter: blur(6px); } 60% { transform: translateY(-6px) translateZ(28px) rotateX(-3deg); opacity:1; filter: blur(0px); } 100% { transform: translateY(0px) translateZ(22px) rotateX(0deg); opacity:1; filter: blur(0px); } }

    .bio { font-size:18px; font-weight:600; color:rgba(255,255,255,0.92); line-height:1.5; min-height:54px; opacity:0; transform: translateY(6px); }
    .bio.visible { animation: bioFade 800ms ease forwards; }
    @keyframes bioFade { to { opacity:1; transform: translateY(0); } }

    .eq { display:flex; gap:6px; margin-top:6px; align-items:end; height:64px; }
    .eq .bar { width:8px; background:linear-gradient(180deg,var(--accentB),var(--accentA)); border-radius:6px; transform-origin: bottom center; box-shadow: 0 6px 20px rgba(6,182,212,0.12); }

    .socials { display:flex; gap:12px; margin-top:12px; flex-wrap:wrap; }
    .social { display:inline-flex; align-items:center; justify-content:center; width:82px; height:82px; border-radius:14px; text-decoration:none; color:white; background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.02)); border:1px solid rgba(255,255,255,0.03); transition: transform .18s ease, box-shadow .18s ease; box-shadow: 0 8px 30px rgba(6,26,37,0.6); font-size:34px; }
    .social:hover { transform:translateY(-6px) scale(1.06); box-shadow: 0 18px 50px rgba(6,26,37,0.8), 0 0 30px rgba(124,58,237,0.12); }

    @media(max-width:820px){ .card { flex-direction:column; align-items:center; padding:22px; gap:18px; } .left { width:100%; display:flex; align-items:center; justify-content:center; } .right { width:100%; text-align:center; padding:0; } .username { font-size:36px; } .avatar-wrap { width:160px; height:160px; } .avatar { width:140px; height:140px; } }

    .float-anim { animation: floaty 6s ease-in-out infinite; }
    @keyframes floaty { 0%{ transform: translateY(0px) } 50%{ transform: translateY(-8px) } 100%{ transform: translateY(0px) } }

    .sparkle { position: fixed; pointer-events: none; border-radius: 50%; background: white; box-shadow: 0 0 10px rgba(255,255,255,0.6); opacity: 0.85; z-index: 6; transform: translate(-50%, -50%); will-change: transform, opacity; transition: opacity 600ms linear; }

    .rotate-overlay { position:fixed; inset:0; z-index:10000; display:none; align-items:center; justify-content:center; background: linear-gradient(180deg, rgba(0,0,0,0.6), rgba(0,0,0,0.8)); color: #fff; text-align:center; padding:20px; font-size:16px; }
    .rotate-overlay .hint { max-width:560px; opacity:0.95; }
    @media (max-width:900px) and (orientation: portrait) { .rotate-overlay { display:flex; } .wrap { transform-origin: center center; transform: rotate(90deg) scale(calc( (100vh / 100vw) )); top:50%; left:50%; position:fixed; } }

    .sr-only { position:absolute; width:1px; height:1px; overflow:hidden; clip:rect(1px,1px,1px,1px); white-space:nowrap; }
  </style>
</head>
<body>

  <div id="vanta-bg"></div>
  <div class="overlay"></div>
  <div class="wave-layer" id="waveLayer" aria-hidden="true"></div>

  <div class="enter-screen" id="enterScreen" role="dialog" aria-modal="true" aria-label="Màn chào mừng">
    <div class="logo">Welcome to my Bio</div>
    <div style="color:rgba(255,255,255,0.65); margin-top:6px">Lưu ý: dùng mobile thì xoay ngang màn hình (màn hình sẽ tự xoay nội dung)</div>
    <button class="enter-btn" id="enterBtn">ENTER</button>
  </div>

  <div class="rotate-overlay" id="rotateOverlay" aria-hidden="true">
    <div class="hint">
      Để trải nghiệm tốt nhất trên điện thoại, xoay thiết bị sang ngang / landscape.<br>
      Nếu bạn không thể xoay, trang sẽ cố gắng xoay nội dung thay bạn.
    </div>
  </div>

  <div class="wrap" id="mainWrap" style="display:none;">
    <div class="card float-anim" role="region" aria-label="Bio card">
      <div class="left">
        <canvas id="avatar-canvas" width="400" height="400" aria-hidden="true"></canvas>

        <div class="avatar-wrap" id="avatarWrap" title="Avatar">
          <div class="avatar-ring" aria-hidden="true"></div>
          <div class="avatar-halo" aria-hidden="true"></div>

          <div class="badge">Premium</div>
          <div class="avatar" id="avatar">
            <img src="static/avatar.png" alt="avatar" id="avatarImg">
          </div>
        </div>

        <div style="width:100%; display:flex; flex-direction:column; align-items:center; margin-top:8px;">
          <div style="font-size:12px; color:rgba(255,255,255,0.6);">Now playing</div>
          <div class="eq" id="eq" aria-hidden="true">
            <div class="bar" style="height:14%"></div>
            <div class="bar" style="height:22%"></div>
            <div class="bar" style="height:18%"></div>
            <div class="bar" style="height:10%"></div>
            <div class="bar" style="height:26%"></div>
            <div class="bar" style="height:12%"></div>
            <div class="bar" style="height:20%"></div>
            <div class="bar" style="height:16%"></div>
            <div class="bar" style="height:22%"></div>
            <div class="bar" style="height:11%"></div>
            <div class="bar" style="height:24%"></div>
            <div class="bar" style="height:18%"></div>
          </div>
        </div>
      </div>

      <div class="right">
        <div style="display:flex; align-items:center; gap:12px; flex-wrap:wrap;">
          <div class="username neon" id="username" data-shadow="NguyenTrongg" aria-live="polite"></div>
        </div>

        <div class="bio" id="bioText" aria-live="polite"></div>

        <div class="socials" id="socials">
          <a class="social" href="https://www.facebook.com/NguyenTrong6565" target="_blank" rel="noopener noreferrer" aria-label="Facebook" id="facebook"><i class="fab fa-facebook-f"></i></a>
          <a class="social" href="https://discord.gg/bpZqKr2EWQ" target="_blank" rel="noopener noreferrer" aria-label="Discord" id="discord"><i class="fab fa-discord"></i></a>
        </div>

        <div style="margin-top:auto; color:rgba(255,255,255,0.45); font-size:13px;">
          Liên hệ facebook/discord
        </div>
      </div>
    </div>
  </div>

  <audio id="bgAudio" loop crossorigin="anonymous">
    <source src="static/music.mp3" type="audio/mpeg">
  </audio>

  <script>

    (function initNebula(){
      const container = document.getElementById('vanta-bg');
      const renderer = new THREE.WebGLRenderer({ antialias:true, alpha:true });
      renderer.setPixelRatio(window.devicePixelRatio||1);
      renderer.setSize(window.innerWidth, window.innerHeight);
      renderer.domElement.style.position='absolute';
      renderer.domElement.style.inset='0';
      container.innerHTML = '';
      container.appendChild(renderer.domElement);

      const scene = new THREE.Scene();
      scene.fog = new THREE.FogExp2(0x030312, 0.0009);

      const camera = new THREE.PerspectiveCamera(60, window.innerWidth/window.innerHeight, 0.1, 5000);
      camera.position.set(0, 40, 220);

      scene.add(new THREE.AmbientLight(0xffffff, 0.25));
      const dir = new THREE.DirectionalLight(0xfff2d6, 0.6);
      dir.position.set(-100,120,80);
      scene.add(dir);

      // soft sprite
      const sprite = (function(){
        const c = document.createElement('canvas'); c.width = 64; c.height = 64;
        const ctx = c.getContext('2d');
        const g = ctx.createRadialGradient(32,32,2,32,32,32);
        g.addColorStop(0, 'rgba(255,255,255,1)');
        g.addColorStop(0.15, 'rgba(255,240,200,0.9)');
        g.addColorStop(0.35, 'rgba(200,160,255,0.7)');
        g.addColorStop(0.65, 'rgba(120,200,255,0.45)');
        g.addColorStop(1, 'rgba(0,0,0,0)');
        ctx.fillStyle = g; ctx.fillRect(0,0,64,64);
        return new THREE.CanvasTexture(c);
      })();

      // volumetric layers
      const layers = [];
      for(let L=0; L<5; L++){
        const count = 24000 - L*2800;
        const geom = new THREE.BufferGeometry();
        const pos = new Float32Array(count*3);
        const col = new Float32Array(count*3);
        for(let i=0;i<count;i++){
          const i3 = i*3;
          pos[i3+0] = (Math.random()-0.5)*800;
          pos[i3+1] = (Math.random()-0.5)*300;
          pos[i3+2] = -Math.random()*1800 - L*200;
          const t = Math.random();
          col[i3+0] = 0.6*(1-t) + 0.9*t;
          col[i3+1] = 0.4*(1-t) + 0.6*t;
          col[i3+2] = 0.8*(1-t) + 1.0*t;
        }
        geom.setAttribute('position', new THREE.BufferAttribute(pos,3));
        geom.setAttribute('color', new THREE.BufferAttribute(col,3));
        const mat = new THREE.PointsMaterial({ size: 18 - L*2, map: sprite, vertexColors: true, transparent:true, blending: THREE.AdditiveBlending, depthWrite:false, opacity: 0.22 + (0.12*(5-L)) });
        const pts = new THREE.Points(geom, mat);
        pts.renderOrder = 10+L;
        scene.add(pts);
        layers.push({points:pts, geom:geom});
      }

      // ribbons
      const ribbons = new THREE.Group();
      for(let r=0;r<6;r++){
        const curve = new THREE.CatmullRomCurve3([
          new THREE.Vector3(-300 + r*40, -40 + r*10, -20 - r*160),
          new THREE.Vector3(-120 + r*30, 40 + r*20, -260 - r*160),
          new THREE.Vector3(80 + r*40, -20 + r*10, -480 - r*160),
          new THREE.Vector3(240 + r*60, 10 + r*6, -760 - r*160)
        ]);
        const pts = curve.getPoints(200);
        const geom = new THREE.BufferGeometry().setFromPoints(pts);
        const color = new THREE.Color().setHSL(0.72 - r*0.02, 0.65, 0.55);
        const mat = new THREE.LineBasicMaterial({ color: color, transparent:true, opacity:0.08, blending:THREE.AdditiveBlending });
        const line = new THREE.Line(geom, mat);
        ribbons.add(line);
      }
      scene.add(ribbons);

      // foreground specks
      const fgCount = 800;
      const fgGeom = new THREE.BufferGeometry();
      const fgPos = new Float32Array(fgCount*3);
      for(let i=0;i<fgCount;i++){ const i3=i*3; fgPos[i3+0]=(Math.random()-0.5)*800; fgPos[i3+1]=(Math.random()-0.5)*300; fgPos[i3+2]=-20 - Math.random()*360; }
      fgGeom.setAttribute('position', new THREE.BufferAttribute(fgPos,3));
      const fgMat = new THREE.PointsMaterial({ size:8, map: sprite, transparent:true, blending:THREE.AdditiveBlending, depthWrite:false, color:0xffffff, opacity:0.95 });
      const fgPoints = new THREE.Points(fgGeom, fgMat);
      scene.add(fgPoints);

      const core = new THREE.Mesh(new THREE.SphereBufferGeometry(26,32,32), new THREE.MeshBasicMaterial({ color:0xffd9b8, transparent:true, opacity:0.9, blending:THREE.AdditiveBlending }));
      core.position.set(0,-6,-220); scene.add(core);

      window.addEventListener('resize', ()=>{ camera.aspect = window.innerWidth/window.innerHeight; camera.updateProjectionMatrix(); renderer.setSize(window.innerWidth, window.innerHeight); });

      let speed = 0.9; let zOffset = 0; let mx=0,my=0;
      document.addEventListener('mousemove', (e)=>{ mx = (e.clientX/window.innerWidth - 0.5)*0.9; my = (e.clientY/window.innerHeight - 0.5)*0.6; });

      const clock = new THREE.Clock();
      (function animate(){
        const t = clock.getElapsedTime();
        zOffset += speed * 1.6;
        camera.position.z = 220 - zOffset;
        if(camera.position.z < -1800){ zOffset = 0; camera.position.z = 220; }
        camera.position.x += (mx*120 - camera.position.x) * 0.04;
        camera.position.y += (-my*80 - camera.position.y + 20) * 0.04;
        camera.lookAt(0,0,-300 - zOffset*0.06);

        for(let L=0; L<layers.length; L++){
          const item = layers[L];
          item.points.rotation.y = t*0.003*(1 + L*0.25);
          const arr = item.geom.attributes.position.array;
          for(let i=0;i<arr.length;i+=3){ arr[i+2] += 0.02 * (1+L*0.06); if(arr[i+2] > 300) arr[i+2] = -1800 - Math.random()*200; }
          item.geom.attributes.position.needsUpdate = true;
        }

        ribbons.children.forEach((ln, idx)=>{ ln.material.opacity = 0.06 + Math.sin(t*0.3 + idx)*0.02; });

        const fgArr = fgGeom.attributes.position.array;
        for(let i=0;i<fgCount;i++){ const i3=i*3; fgArr[i3+2] += 0.6 + Math.sin(t*0.6 + i)*0.02; fgArr[i3+0] += Math.cos(t*0.2 + i*0.7)*0.03; if(fgArr[i3+2] > 200) fgArr[i3+2] = -260 - Math.random()*120; }
        fgGeom.attributes.position.needsUpdate = true;

        renderer.render(scene, camera);
        requestAnimationFrame(animate);
      })();

      window._NEBULA = { renderer, scene, camera };
    })();


    const enterBtn = document.getElementById('enterBtn');
    const enterScreen = document.getElementById('enterScreen');
    const mainWrap = document.getElementById('mainWrap');
    const bgAudio = document.getElementById('bgAudio');
    const usernameEl = document.getElementById('username');
    const waveLayer = document.getElementById('waveLayer');
    const rotateOverlay = document.getElementById('rotateOverlay');
    const avatarImg = document.getElementById('avatarImg');

    const displayName = 'NguyenTrongg';
    const bioString = "Anh Trongg đẹp trai chim dài, còn em đóng vai người chồng bất lực nhìn vợ mình bị ăn thịt";

    function render3DName(text){
      usernameEl.innerHTML = '';
      const frag = document.createDocumentFragment();
      const arr = Array.from(text);
      arr.forEach((ch, idx) => {
        const span = document.createElement('span');
        span.className = 'letter';
        span.setAttribute('data-char', ch === ' ' ? '\u00A0' : ch);
        span.textContent = ch === ' ' ? '\u00A0' : ch;
        const delay = 80 * idx;
        span.style.animationDelay = `${delay}ms`;
        if(ch.trim() !== '' && Math.random() > 0.22) span.classList.add('float-anim');
        const tz = 20 + Math.floor(Math.random()*28);
        const rx = -6 + Math.random()*12;
        const ry = -6 + Math.random()*12;
        span.style.transform = `translateZ(${tz}px) rotateX(${rx}deg) rotateY(${ry}deg)`;
        frag.appendChild(span);
      });
      usernameEl.appendChild(frag);
      requestAnimationFrame(()=> {
        const letters = usernameEl.querySelectorAll('.letter');
        letters.forEach((l,i) => {
          setTimeout(()=> l.classList.add('in'), i*22);
        });
      });
    }

    function spawnWave(clientX, clientY){
      const el = document.createElement('div');
      el.className = 'wave';
      el.style.left = clientX + 'px';
      el.style.top = clientY + 'px';
      waveLayer.appendChild(el);
      el.addEventListener('animationend', ()=> el.remove());
    }

    let lastWaveAt = 0;
    document.addEventListener('mousemove', e => {
      const now = Date.now();
      if(now - lastWaveAt < 220) return;
      lastWaveAt = now;
      spawnWave(e.clientX, e.clientY);
      applyPointer3DEffect(e.clientX, e.clientY);
    });

    document.addEventListener('click', e => {
      const large = document.createElement('div');
      large.className = 'wave';
      large.style.width = '260px';
      large.style.height = '260px';
      large.style.left = e.clientX + 'px';
      large.style.top = e.clientY + 'px';
      large.style.animation = 'waveExpand 1100ms cubic-bezier(.2,.9,.3,1) forwards';
      large.style.filter = 'blur(6px) saturate(1.3)';
      waveLayer.appendChild(large);
      large.addEventListener('animationend', ()=> large.remove());
      spawnBurst(e.clientX, e.clientY);
    });

    function applyPointer3DEffect(cx, cy){
      const rect = usernameEl.getBoundingClientRect();
      if(rect.width === 0) return;
      const centerX = rect.left + rect.width/2;
      const centerY = rect.top + rect.height/2;
      const dx = (cx - centerX) / rect.width;
      const dy = (cy - centerY) / rect.height;
      usernameEl.style.transform = `perspective(900px) rotateX(${(-dy*6).toFixed(2)}deg) rotateY(${(dx*8).toFixed(2)}deg)`;
      const letters = usernameEl.querySelectorAll('.letter');
      letters.forEach((l, i) => {
        const offset = (i - letters.length/2) * 0.22;
        const tz = 18 + offset * 6 - dx*14;
        const rx = -4 + dy*8 + Math.sin(i*0.6)*2;
        const ry = dx*6 + Math.cos(i*0.4)*2;
        l.style.transform = `translateZ(${tz}px) rotateX(${rx.toFixed(2)}deg) rotateY(${ry.toFixed(2)}deg)`;
      });
    }

    document.addEventListener('mouseleave', () => {
      usernameEl.style.transform = '';
      const letters = usernameEl.querySelectorAll('.letter');
      letters.forEach((l) => { l.style.transform = l.style.transform.replace(/translateZ\([^)]+\)/,'translateZ(22px)'); });
    });

    function pulseAvatar(){
      const avatar = document.getElementById('avatar');
      avatar.style.transition = 'transform 220ms cubic-bezier(.2,.8,.2,1)';
      avatar.style.transform = 'scale(1.06)';
      setTimeout(()=> avatar.style.transform = 'scale(1)', 220);
    }

    const canvas = document.getElementById('avatar-canvas');
    const ctx = canvas.getContext('2d');
    let particles = [];
    const DPR = window.devicePixelRatio || 1;
    function resizeCanvas(){ canvas.width = canvas.clientWidth * DPR; canvas.height = canvas.clientHeight * DPR; }
    resizeCanvas();
    window.addEventListener('resize', resizeCanvas);

    function spawnParticle(x, y){
      const angle = Math.random()*Math.PI*2;
      const speed = 0.6 + Math.random()*2.4;
      particles.push({ x: x, y: y, vx: Math.cos(angle)*speed, vy: Math.sin(angle)*speed - 1.2, life: 60 + Math.random()*40, r: 1 + Math.random()*3, hue: 260 + Math.random()*60 });
      if(particles.length>220) particles.splice(0, particles.length-220);
    }

    function spawnBurst(clientX, clientY){
      const rect = canvas.getBoundingClientRect();
      const x = (clientX - rect.left) * DPR;
      const y = (clientY - rect.top) * DPR;
      for(let i=0;i<34;i++) spawnParticle(x, y);
    }

    setInterval(()=> {
      const rect = canvas.getBoundingClientRect();
      const cx = rect.width*DPR/2; const cy = rect.height*DPR/2;
      if(Math.random() < 0.6) spawnParticle(cx + (Math.random()-0.5)*40*DPR, cy + (Math.random()-0.5)*40*DPR);
    }, 160);

    function updateParticles(){
      ctx.clearRect(0,0,canvas.width,canvas.height);
      for(let i=particles.length-1;i>=0;i--){
        const p = particles[i];
        p.x += p.vx * DPR;
        p.y += p.vy * DPR;
        p.vy += 0.06 * DPR;
        p.life--;
        ctx.beginPath();
        const g = ctx.createRadialGradient(p.x, p.y, 0, p.x, p.y, p.r*6*DPR);
        g.addColorStop(0, `hsla(${p.hue},85%,65%,0.95)`);
        g.addColorStop(0.35, `hsla(${p.hue},85%,55%,0.45)`);
        g.addColorStop(1, `hsla(${p.hue},85%,45%,0)`);
        ctx.fillStyle = g;
        ctx.arc(p.x, p.y, p.r*DPR, 0, Math.PI*2);
        ctx.fill();
        if(p.life <= 0) particles.splice(i,1);
      }
      requestAnimationFrame(updateParticles);
    }
    requestAnimationFrame(updateParticles);

    let audioCtx, analyser, sourceNode;
    function initAudioReactive(){
      if(!window.AudioContext && !window.webkitAudioContext) return;
      audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      analyser = audioCtx.createAnalyser();
      analyser.fftSize = 256;
      const bufferLength = analyser.frequencyBinCount;
      const dataArray = new Uint8Array(bufferLength);
      try { sourceNode = audioCtx.createMediaElementSource(bgAudio); } catch(e) { console.warn('Cannot create media source: ', e); return; }
      sourceNode.connect(analyser);
      analyser.connect(audioCtx.destination);
      const bars = document.querySelectorAll('.eq .bar');
      function renderFrame(){
        analyser.getByteFrequencyData(dataArray);
        const step = Math.floor(dataArray.length / bars.length);
        for(let i=0;i<bars.length;i++){ const sum = dataArray[i*step] || 0; const h = Math.max(6, (sum / 255) * 100); bars[i].style.height = `${h}%`; bars[i].style.opacity = 0.6 + (h/200); }
        const bass = dataArray[2] + dataArray[3] + dataArray[4];
        const scale = 1 + Math.min(0.18, bass/800);
        document.querySelector('.avatar-ring').style.transform = `scale(${scale})`;
        requestAnimationFrame(renderFrame);
      }
      renderFrame();
    }

    const bioText = document.getElementById('bioText');
    function typewriterText(str, speed = 28){
      bioText.textContent = '';
      let i=0;
      function step(){ if(i < str.length){ bioText.textContent += str.charAt(i++); setTimeout(step, speed); } else { bioText.classList.add('visible'); } }
      setTimeout(step, 360);
    }

    function initialEntranceWave(){ const cx = window.innerWidth/2; const cy = window.innerHeight/2; spawnWave(cx, cy); setTimeout(()=> spawnWave(cx+120, cy-80), 160); setTimeout(()=> spawnWave(cx-160, cy+60), 320); }

    enterBtn.addEventListener('click', async () => {
      enterScreen.classList.add('exit');
      setTimeout(()=>{ enterScreen.style.display='none'; mainWrap.style.display='flex'; }, 800);
      setTimeout(initialEntranceWave, 240);
      try { await bgAudio.play(); fadeInAudio(bgAudio, 0.0, 0.9, 1800); initAudioReactive(); } catch (e) { console.log('Audio autoplay blocked', e); }
      render3DName(displayName);
      typewriterText(bioString, 28);
      spawnPersistentSparkles(80);
    });

    function fadeInAudio(audio, from, to, ms){ audio.volume = from; const step = (to - from) / (ms/60); const it = setInterval(()=>{ audio.volume = Math.min(to, audio.volume + step); if(audio.volume >= to) clearInterval(it); }, 60); }

    const avatarWrap = document.getElementById('avatarWrap');
    avatarWrap.addEventListener('mousemove', (e) => {
      const rect = avatarWrap.getBoundingClientRect();
      const px = (e.clientX - rect.left) / rect.width;
      const py = (e.clientY - rect.top) / rect.height;
      const rx = (py - 0.5) * 12;
      const ry = (px - 0.5) * -18;
      avatarWrap.style.transform = `perspective(700px) rotateX(${rx}deg) rotateY(${ry}deg) scale(1.03)`;
      document.getElementById('avatar').style.filter = `brightness(${1 + Math.abs(px-0.5) * 0.12}) saturate(${1 + Math.abs(py-0.5) * 0.06})`;
    });
    avatarWrap.addEventListener('mouseleave', () => { avatarWrap.style.transform = 'perspective(700px) rotateX(0) rotateY(0) scale(1)'; document.getElementById('avatar').style.filter = 'brightness(1) saturate(1)'; });
    avatarWrap.addEventListener('click', (e) => { pulseAvatar(); spawnBurst(e.clientX, e.clientY); spawnWave(e.clientX, e.clientY); });

    (function attachSocialExplosions(){ const socials = document.querySelectorAll('.socials a.social'); socials.forEach(a => { a.addEventListener('click', function(ev){ ev.preventDefault(); const r = a.getBoundingClientRect(); const cx = r.left + r.width/2; const cy = r.top + r.height/2; spawnExplosionVisual(cx, cy); a.style.transition = 'transform .22s ease'; a.style.transform = 'scale(0.95)'; setTimeout(()=> a.style.transform = '', 220); const href = a.href; setTimeout(()=> { try { window.open(href, '_blank', 'noopener'); } catch(e){ window.location.href = href; } }, 520); }); }); function spawnExplosionVisual(x, y){ const count = 20; for (let i=0;i<count;i++){ const el = document.createElement('div'); el.className = 'sparkle'; const size = Math.random()*8 + 4; el.style.width = el.style.height = size + 'px'; el.style.left = x + 'px'; el.style.top = y + 'px'; el.style.opacity = 1; document.body.appendChild(el); const angle = Math.random()*Math.PI*2; const dist = 40 + Math.random()*160; const dx = Math.cos(angle)*dist; const dy = Math.sin(angle)*dist - (Math.random()*40); el.animate([ { transform: 'translate(0,0) scale(1)', opacity: 1 }, { transform: `translate(${dx}px, ${dy}px) scale(0.3)`, opacity: 0 } ], { duration: 600 + Math.random()*700, easing: 'cubic-bezier(.2,.9,.3,1)' }); setTimeout(()=> el.remove(), 1300); } } })();

    function spawnExplosion(x, y) { for (let i = 0; i < 20; i++) { const p = document.createElement("div"); p.classList.add("sparkle"); p.style.width = p.style.height = Math.random() * 6 + 4 + "px"; p.style.left = x + "px"; p.style.top = y + "px"; p.style.background = "white"; document.body.appendChild(p); setTimeout(() => p.remove(), 2000); } }
    function spawnBurst(clientX, clientY){ const rect = canvas.getBoundingClientRect(); const x = (clientX - rect.left) * DPR; const y = (clientY - rect.top) * DPR; for(let i=0;i<26;i++) spawnParticle(x, y); }

    let sparkleInterval;
    function spawnPersistentSparkles(n = 30){ if(sparkleInterval) clearInterval(sparkleInterval); for(let i=0;i<n;i++) createFloatingSparkle(); sparkleInterval = setInterval(()=> { createFloatingSparkle(); }, 600); }
    function createFloatingSparkle(){ const el = document.createElement('div'); el.className = 'sparkle'; const size = Math.random()*4 + 3; el.style.width = el.style.height = size + 'px'; el.style.left = Math.random()*window.innerWidth + 'px'; el.style.top = Math.random()*window.innerHeight + 'px'; el.style.opacity = 0; el.style.background = 'linear-gradient(180deg, rgba(255,255,255,1), rgba(220,240,255,0.9))'; el.style.boxShadow = '0 0 10px rgba(255,255,255,0.9)'; document.body.appendChild(el); const dx = (Math.random()*200 - 100); const dy = (Math.random()*140 - 70); const dur = 1800 + Math.random()*2200; el.animate([ { opacity: 0, transform: 'translate(0,0) scale(0.8)' }, { opacity: 0.9, transform: `translate(${dx/3}px, ${dy/3}px) scale(1)` }, { opacity: 0, transform: `translate(${dx}px, ${dy}px) scale(0.6)` } ], { duration: dur, easing: 'linear', fill: 'forwards' }); setTimeout(()=> el.remove(), dur + 90); }

    function checkOrientationOverlay(){ const isPortrait = window.matchMedia('(orientation: portrait)').matches && window.innerWidth < 900; if(isPortrait){ rotateOverlay.style.display = 'flex'; } else { rotateOverlay.style.display = 'none'; } }
    window.addEventListener('resize', checkOrientationOverlay);
    window.addEventListener('orientationchange', checkOrientationOverlay);
    checkOrientationOverlay();

    (function protectShortcuts(){ document.addEventListener('contextmenu', function(e){ e.preventDefault(); }); document.addEventListener('keydown', function(e){ if (e.key === 'F12') { e.preventDefault(); return; } if (e.ctrlKey && e.shiftKey && (e.key === 'I' || e.key === 'i' || e.key === 'J' || e.key === 'j' || e.key === 'C' || e.key === 'c')) { e.preventDefault(); return; } if (e.ctrlKey && (e.key === 'U' || e.key === 'u' || e.key === 'S' || e.key === 's')) { e.preventDefault(); return; } }, {capture:true}); })();

    (function attachEnterEffects(){ const enter = document.getElementById('enterBtn'); enter.addEventListener('click', function(){ setTimeout(()=> spawnBlueWave(window.innerWidth/2, window.innerHeight/2), 280); setTimeout(()=> spawnBlueWave(window.innerWidth/2 + 140, window.innerHeight/2 - 80), 420); setTimeout(()=> spawnBlueWave(window.innerWidth/2 - 160, window.innerHeight/2 + 60), 620); }); function spawnBlueWave(cx, cy){ const el = document.createElement('div'); el.className = 'wave'; el.style.background = 'radial-gradient(circle, rgba(255,255,255,0.95), rgba(200,200,255,0.38) 40%, rgba(200,200,255,0.12) 60%, transparent 75%)'; el.style.left = cx + 'px'; el.style.top = cy + 'px'; el.style.filter = 'blur(6px) saturate(1.05)'; el.style.boxShadow = '0 30px 80px rgba(200,200,255,0.08)'; waveLayer.appendChild(el); el.addEventListener('animationend', ()=> el.remove()); } })();

    window.setVipProfile = function({name, bio, avatarPath}){ if(name) { render3DName(name); document.getElementById('username').setAttribute('data-shadow', name); } if(bio) { typewriterText(bio, 24); } if(avatarPath) { document.querySelector('#avatar img').src = avatarPath; } };

    render3DName(displayName);
    window.addEventListener('load', ()=> { setTimeout(()=> spawnBurst(canvas.getBoundingClientRect().left + canvas.width/2, canvas.getBoundingClientRect().top + canvas.height/2), 1200); setTimeout(initialEntranceWave, 800); });
  </script>

</body>
</html>
