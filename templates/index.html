<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Bio — NguyenTrongg</title>

  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@500;700;900&family=Poppins:wght@300;400;600;800&display=swap" rel="stylesheet">

  <!-- Three.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r121/three.min.js"></script>

  <style>
    :root{
      --bg:#05060a;
      --glass: rgba(255,255,255,0.03);
      --gold1:#ffd54a;
      --gold2:#ffb300;
      --accentA: #7c3aed;
      --accentB: #06b6d4;
      --purple-main: #9b5cff;
      --purple-deep: #5b1bd9;
      --purple-glow: rgba(155,92,255,0.18);
      --max-width: 980px;
    }
    *{box-sizing:border-box;margin:0;padding:0}
    html,body{height:100%;}
    body{
      font-family:'Poppins',sans-serif;
      background:var(--bg);
      color:#fff;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      overflow:hidden;
    }


    #vanta-bg { position:fixed; inset:0; z-index:0; pointer-events:none; }

    .overlay {
      position:fixed; inset:0; z-index:1; pointer-events:none;
      background: linear-gradient(180deg, rgba(0,0,0,0.12), rgba(0,0,0,0.32));
      mix-blend-mode: overlay;
    }

    .wave-layer { position:fixed; inset:0; z-index:9; pointer-events:none; overflow:visible; perspective:1200px; }
    .wave {
      position:absolute; width:160px; height:160px; border-radius:50%;
      transform-origin:center;
      background: radial-gradient(circle at 40% 40%, rgba(155,92,255,0.85), rgba(91,27,217,0.35) 40%, rgba(91,27,217,0.12) 60%, transparent 70%);
      filter: blur(8px) saturate(1.2);
      mix-blend-mode: screen;
      pointer-events:none;
      will-change: transform, opacity;
      animation: waveExpand 1000ms cubic-bezier(.2,.9,.3,1) forwards;
      box-shadow: 0 30px 80px rgba(91,27,217,0.22), inset 0 -6px 30px rgba(255,255,255,0.04);
    }
    @keyframes waveExpand{ 0%{ transform: translate3d(-50%,-50%,0) scale(.28) rotateX(18deg); opacity:0.95 } 60%{ transform: translate3d(-50%,-50%,-140px) scale(1.6) rotateX(8deg); opacity:0.52 } 100%{ transform: translate3d(-50%,-50%,-360px) scale(3.6) rotateX(0deg); opacity:0 } }

    .enter-screen{ position:fixed; inset:0; z-index:12; display:flex; align-items:center; justify-content:center; flex-direction:column; gap:18px; background:linear-gradient(180deg, rgba(2,6,23,0.85), rgba(0,0,0,0.9)); backdrop-filter: blur(6px); }
    .logo{ font-family:'Montserrat',sans-serif; font-size:42px; font-weight:900; letter-spacing:2px; background:linear-gradient(90deg,var(--accentA),var(--accentB)); -webkit-background-clip:text;color:transparent; text-shadow: 0 6px 30px rgba(0,0,0,0.6); }
    .enter-btn{ padding:14px 36px; border-radius:999px; border:none; cursor:pointer; background:linear-gradient(90deg,var(--gold1),var(--gold2)); color:#0f0f10; font-weight:800; font-size:16px; box-shadow:0 10px 40px rgba(255,181,0,0.12), 0 6px 18px rgba(0,0,0,0.6); transform-origin:center; }
    .enter-screen.exit { animation: enterExit 900ms ease forwards; }
    @keyframes enterExit { 0% { opacity:1; transform: scale(1); } 100% { opacity:0; transform: scale(1.12) translateY(-40px); pointer-events:none; } }

    .wrap { position:relative; z-index:2; min-height:100vh; display:flex; align-items:center; justify-content:center; padding:48px 20px; }
    .card { width:min(95%, var(--max-width)); background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); border-radius:20px; padding:28px; box-shadow: 0 30px 90px rgba(2,6,23,0.7); display:flex; gap:26px; align-items:center; backdrop-filter: blur(8px); border: 1px solid rgba(255,255,255,0.03); position:relative; overflow:hidden; }

    .left { width:320px; min-width:220px; display:flex; flex-direction:column; align-items:center; gap:18px; position:relative; }

    .avatar-wrap { position:relative; width:220px; height:220px; border-radius:999px; display:flex; align-items:center; justify-content:center; transform-style:preserve-3d; transition: transform 200ms ease; cursor:pointer; z-index:3; }
    .avatar-ring { position:absolute; inset:-12px; border-radius:999px; background: conic-gradient(from 0deg, var(--accentA), var(--accentB), #8b5cf6, #06b6d4, var(--accentA)); filter: blur(10px); opacity:0.95; z-index:1; animation: ringRotate 8s linear infinite; pointer-events:none; box-shadow: 0 30px 60px rgba(6,26,37,0.45); border:1px solid rgba(255,255,255,0.02); }
    @keyframes ringRotate { to { transform: rotate(360deg); } }
    .avatar-halo { position:absolute; inset:6px; border-radius:999px; z-index:2; background: radial-gradient(circle at 30% 20%, rgba(124,58,237,0.28), rgba(6,182,212,0.12) 30%, transparent 60%); filter: blur(14px); pointer-events:none; }

    .avatar { width:200px; height:200px; border-radius:999px; overflow:hidden; border: 3px solid rgba(255,255,255,0.06); z-index:3; background:#111; transform: translateZ(40px); box-shadow: 0 20px 60px rgba(6,26,37,0.6), 0 0 30px rgba(124,58,237,0.06); position:relative; display:flex; align-items:center; justify-content:center; }
    .avatar img { width:100%; height:100%; object-fit:cover; display:block; }

    .avatar-upload { position:absolute; right:8px; bottom:8px; z-index:8; width:42px; height:42px; border-radius:10px; display:grid; place-items:center; background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02)); border:1px solid rgba(255,255,255,0.04); cursor:pointer; box-shadow:0 8px 30px rgba(0,0,0,0.6); }
    .avatar-upload i { font-size:18px; color: #fff; }

    .badge { position:absolute; right:-6px; top:-6px; z-index:6; background: linear-gradient(90deg,var(--accentA),var(--accentB)); color:white; font-weight:800; font-size:12px; padding:6px 10px; border-radius:999px; box-shadow:0 8px 30px rgba(7,16,38,0.6); transform: translateZ(60px); border:1px solid rgba(255,255,255,0.06); }

    #avatar-canvas { position:absolute; inset: -30px; z-index:0; pointer-events:none; }

    .right { flex:1; display:flex; flex-direction:column; gap:10px; padding:6px 12px; min-width:220px; }
    .username { font-family:'Montserrat',sans-serif; font-size:48px; font-weight:900; color:transparent; -webkit-text-stroke: 0px rgba(0,0,0,0.2); transform-style:preserve-3d; perspective:900px; display:inline-block; min-height:64px; }
    
.username .letter {
  color: #ffffff !important;
  -webkit-text-fill-color: white !important;
  text-shadow: 0 2px 4px rgba(0,0,0,0.5);
}

    .username .letter.in { animation: letterIn 900ms cubic-bezier(.2,.9,.3,1) forwards; }
    @keyframes letterIn { 0% { transform: translateY(24px) translateZ(6px) rotateX(6deg); opacity:0; filter: blur(6px); } 60% { transform: translateY(-6px) translateZ(28px) rotateX(-3deg); opacity:1; filter: blur(0px); } 100% { transform: translateY(0px) translateZ(22px) rotateX(0deg); opacity:1; filter: blur(0px); } }

    .bio { font-size:18px; font-weight:600; color:rgba(255,255,255,0.92); line-height:1.5; min-height:54px; opacity:0; transform: translateY(6px); }
    .bio.visible { animation: bioFade 800ms ease forwards; }
    @keyframes bioFade { to { opacity:1; transform: translateY(0); } }

    .eq { display:flex; gap:6px; margin-top:6px; align-items:end; height:64px; }
    .eq .bar { width:8px; background:linear-gradient(180deg,var(--accentB),var(--accentA)); border-radius:6px; transform-origin: bottom center; box-shadow: 0 6px 20px rgba(6,182,212,0.12); }

    .socials { display:flex; gap:12px; margin-top:12px; flex-wrap:wrap; }
    .social { display:inline-flex; align-items:center; justify-content:center; width:82px; height:82px; border-radius:14px; text-decoration:none; color:white; background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.02)); border:1px solid rgba(255,255,255,0.03); transition: transform .18s ease, box-shadow .18s ease; box-shadow: 0 8px 30px rgba(6,26,37,0.6); font-size:34px; }
    .social:hover { transform:translateY(-6px) scale(1.06); box-shadow: 0 18px 50px rgba(6,26,37,0.8), 0 0 30px rgba(124,58,237,0.12); }

    @media(max-width:820px){ .card { flex-direction:column; align-items:center; padding:22px; gap:18px; } .left { width:100%; display:flex; align-items:center; justify-content:center; } .right { width:100%; text-align:center; padding:0; } .username { font-size:36px; } .avatar-wrap { width:160px; height:160px; } .avatar { width:140px; height:140px; } }

    .float-anim { animation: floaty 6s ease-in-out infinite; }
    @keyframes floaty { 0%{ transform: translateY(0px) } 50%{ transform: translateY(-8px) } 100%{ transform: translateY(0px) } }

    .sparkle { position: fixed; pointer-events: none; border-radius: 50%; background: white; box-shadow: 0 0 10px rgba(255,255,255,0.6); opacity: 0.85; z-index: 6; transform: translate(-50%, -50%); will-change: transform, opacity; transition: opacity 600ms linear; }

    .rotate-overlay { position:fixed; inset:0; z-index:10000; display:none; align-items:center; justify-content:center; background: linear-gradient(180deg, rgba(0,0,0,0.6), rgba(0,0,0,0.8)); color: #fff; text-align:center; padding:20px; font-size:16px; }
    .rotate-overlay .hint { max-width:560px; opacity:0.95; }
    @media (max-width:900px) and (orientation: portrait) { .rotate-overlay { display:flex; } .wrap { transform-origin: center center; transform: rotate(90deg) scale(calc( (100vh / 100vw) )); top:50%; left:50%; position:fixed; } }

    .__shine { position: absolute; top: -10%; left: -60%; width: 40%; height: 120%; background: linear-gradient(120deg, transparent, rgba(255,255,255,0.5), transparent); transform: skewX(-25deg); mix-blend-mode: overlay; pointer-events: none; z-index: 999; animation: __shineMove 1200ms ease forwards; }
    @keyframes __shineMove { to { left: 140%; } }

    .sr-only { position:absolute; width:1px; height:1px; overflow:hidden; clip:rect(1px,1px,1px,1px); white-space:nowrap; }
  

.avatar-ring {
  background: conic-gradient(from 0deg, #b388ff, #00eaff, #b388ff);
  animation: ringRotate 8s linear infinite, ringPulse 4s ease-in-out infinite;
  box-shadow: 0 0 20px rgba(179,136,255,0.6), 0 0 40px rgba(0,234,255,0.4);
}
@keyframes ringPulse {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.08); }
}
.avatar-wrap:hover .avatar-ring {
  filter: brightness(1.2);
}

.avatar-wrap:hover::after {
  content: '';
  position: absolute;
  width: 180%;
  height: 2px;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,0.8), transparent);
  top: 50%;
  left: -40%;
  transform: rotate(25deg);
  animation: lensSweep 1s ease-out forwards;
}
@keyframes lensSweep {
  to { left: 140%; opacity: 0; }
}


body::before {
  content: '';
  position: fixed;
  inset: 0;
  background: radial-gradient(circle at 30% 40%, rgba(179,136,255,0.15), transparent 60%),
              radial-gradient(circle at 70% 60%, rgba(0,234,255,0.15), transparent 60%);
  z-index: 0;
  animation: nebulaShift 20s ease-in-out infinite;
}
@keyframes nebulaShift {
  0%, 100% { filter: hue-rotate(0deg); }
  50% { filter: hue-rotate(30deg); }
}


.card {
  border: 1px solid rgba(255,255,255,0.05);
  position: relative;
  overflow: hidden;
}
.card::after {
  content: '';
  position: absolute;
  top: 0; left: -150%;
  width: 150%;
  height: 100%;
  background: linear-gradient(120deg, transparent, rgba(255,255,255,0.08), transparent);
  animation: borderSweep 6s linear infinite;
}
@keyframes borderSweep {
  0% { left: -150%; }
  100% { left: 150%; }
}
.card:hover {
  transform: translateY(-4px) scale(1.02);
  box-shadow: 0 12px 40px rgba(179,136,255,0.25), 0 6px 20px rgba(0,234,255,0.2);
}


.social {
  box-shadow: 0 0 12px rgba(179,136,255,0.4), 0 0 24px rgba(0,234,255,0.3);
}
.social:hover {
  box-shadow: 0 0 16px rgba(179,136,255,0.6), 0 0 32px rgba(0,234,255,0.5);
}

=
.eq .bar {
  background: linear-gradient(180deg, #00eaff, #b388ff);
}

</style>

<style>

.username .letter {
  color: #ffffff !important;
  -webkit-text-fill-color: white !important;
  text-shadow: 0 2px 4px rgba(0,0,0,0.5);
}

.avatar-ring {
  background: radial-gradient(circle, rgba(255,255,255,1), rgba(255,255,255,0.3)) !important;
  box-shadow: 0 0 20px rgba(255,255,255,0.9), 0 0 40px rgba(255,255,255,0.5) !important;
}
.big-star {
  position: absolute;
  border-radius: 50%;
  background: white;
  box-shadow: 0 0 20px rgba(255,255,255,0.9);
  pointer-events: none;
  opacity: 0.8;
  transform: translate(-50%,-50%) scale(1);
  animation: starMove 2s linear forwards;
  z-index: 9999;
}
@keyframes starMove {
  0% { opacity: 1; transform: translate(-50%,-50%) scale(1); }
  100% { opacity: 0; transform: translate(-50%,-50%) scale(0.2) translateY(-80px); }
}
</style>

<style>

.card {
  border: 2px solid transparent;
  position: relative;
  transition: transform 260ms ease, box-shadow 260ms ease;
  box-shadow: 0 20px 60px rgba(11,12,20,0.6), inset 0 1px 0 rgba(255,255,255,0.02);
}
.card::before{
  content:'';
  position:absolute; inset:-2px;
  background: linear-gradient(90deg, rgba(155,92,255,0.18), rgba(6,182,212,0.18), rgba(255,181,0,0.12));
  border-radius:22px;
  z-index:0;
  filter: blur(10px);
  opacity:0.9;
  pointer-events:none;
  animation: borderShift 8s linear infinite;
}
@keyframes borderShift{ 0%{transform:translateX(0)} 50%{transform:translateX(40%)} 100%{transform:translateX(0)} }


.avatar-ring{
  background: conic-gradient(from 0deg, var(--accentA), var(--accentB), #8b5cf6, #06b6d4, var(--accentA));
  filter: blur(8px) saturate(1.05);
  animation: ringRotate 8s linear infinite, ringColor 6s ease-in-out infinite;
  z-index:1;
}
@keyframes ringColor{ 0%{opacity:0.95; transform:scale(1)} 50%{opacity:1; transform:scale(1.06)} 100%{opacity:0.95; transform:scale(1)} }


.avatar-visualizer {
  position:absolute;
  left:50%; top:50%;
  width:300px; height:300px;
  transform:translate(-50%,-50%) scale(1);
  border-radius:50%;
  pointer-events:none;
  mix-blend-mode:screen;
  z-index:0;
  transition: transform 120ms linear;
  filter: blur(8px);
}
.avatar-visualizer .ring { position:absolute; inset:0; border-radius:50%; box-shadow: 0 0 40px rgba(155,92,255,0.08), inset 0 0 80px rgba(6,182,212,0.04); border:1px solid rgba(255,255,255,0.02); }

/* Username neon pulsate tied to music via JS (NEW) */

.username .letter {
  color: #ffffff !important;
  -webkit-text-fill-color: white !important;
  text-shadow: 0 2px 4px rgba(0,0,0,0.5);
}



.social { position:relative; overflow:hidden; }
.social::after{ content:''; position:absolute; width:12px; height:12px; background:rgba(255,255,255,0.6); border-radius:50%; transform:scale(0); opacity:0; pointer-events:none; transition:transform .5s ease, opacity .6s ease; }
.social.active::after{ transform:scale(20); opacity:0; transition:transform .6s cubic-bezier(.2,.9,.2,1), opacity .6s ease; }

/* Shooting star */
.shooting-star { position:fixed; width:2px; height:90px; background: linear-gradient(90deg, rgba(255,255,255,1), rgba(255,255,255,0)); z-index:8; pointer-events:none; transform: rotate(-30deg); filter: blur(1px); }
/* ===== NEW UPGRADE CSS (END) ===== */
</style></head>
<body>

  <div id="vanta-bg"></div>
  <div class="overlay"></div>
  <div class="wave-layer" id="waveLayer" aria-hidden="true"></div>

  <div class="enter-screen" id="enterScreen" role="dialog" aria-modal="true" aria-label="Màn chào mừng">
    <div class="logo">Welcome to my Bio</div>
    <div style="color:rgba(255,255,255,0.65); margin-top:6px">Lưu ý: dùng mobile thì xoay ngang màn hình (màn hình sẽ tự xoay nội dung)</div>
    <button class="enter-btn" id="enterBtn">ENTER</button>
  </div>

  <div class="rotate-overlay" id="rotateOverlay" aria-hidden="true">
    <div class="hint">
      Để trải nghiệm tốt nhất trên điện thoại, xoay thiết bị sang ngang / landscape.<br>
      Nếu bạn không thể xoay, trang sẽ cố gắng xoay nội dung thay bạn.
    </div>
  </div>

  <div class="wrap" id="mainWrap" style="display:none;">
    <div class="card float-anim" role="region" aria-label="Bio card">
      <div class="left">
        <canvas id="avatar-canvas" width="400" height="400" aria-hidden="true"></canvas>

        <div class="avatar-wrap" id="avatarWrap" title="Avatar">
          <div class="avatar-ring" aria-hidden="true"></div>
          <div class="avatar-halo" aria-hidden="true"></div>

          <div class="badge">Premium</div>
          <div class="avatar" id="avatar">
            <img src="static/avatar.png" alt="avatar" id="avatarImg">
          </div>
        </div>

        <div style="width:100%; display:flex; flex-direction:column; align-items:center; margin-top:8px;">
          <div style="font-size:12px; color:rgba(255,255,255,0.6);">Now playing</div>
          <div class="eq" id="eq" aria-hidden="true">
            <div class="bar" style="height:14%"></div>
            <div class="bar" style="height:22%"></div>
            <div class="bar" style="height:18%"></div>
            <div class="bar" style="height:10%"></div>
            <div class="bar" style="height:26%"></div>
            <div class="bar" style="height:12%"></div>
            <div class="bar" style="height:20%"></div>
            <div class="bar" style="height:16%"></div>
            <div class="bar" style="height:22%"></div>
            <div class="bar" style="height:11%"></div>
            <div class="bar" style="height:24%"></div>
            <div class="bar" style="height:18%"></div>
          </div>
        </div>
      </div>

      <div class="right">
        <div style="display:flex; align-items:center; gap:12px; flex-wrap:wrap;">
          <div class="username neon" id="username" data-shadow="NguyenTrongg" aria-live="polite"></div>
        </div>

        <div class="bio" id="bioText" aria-live="polite"></div>

        <div class="socials" id="socials">
          <a class="social" href="https://www.facebook.com/NguyenTrong6565" target="_blank" rel="noopener noreferrer" aria-label="Facebook" id="facebook"><i class="fab fa-facebook-f"></i></a>
          <a class="social" href="https://discord.gg/bpZqKr2EWQ" target="_blank" rel="noopener noreferrer" aria-label="Discord" id="discord"><i class="fab fa-discord"></i></a>
        </div>

        <div style="margin-top:auto; color:rgba(255,255,255,0.45); font-size:13px;">
          Liên hệ fb/discord
        </div>
      </div>
    </div>
  </div>

  <audio id="bgAudio" loop crossorigin="anonymous">
    <source src="static/music.mp3" type="audio/mpeg">
  </audio>

  <script>

    (function initGalaxy(){
      const container = document.getElementById('vanta-bg');
      const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
      renderer.setPixelRatio(window.devicePixelRatio || 1);
      renderer.setSize(window.innerWidth, window.innerHeight);
      renderer.domElement.style.position = 'absolute';
      renderer.domElement.style.top = '0';
      renderer.domElement.style.left = '0';
      renderer.domElement.style.width = '100%';
      renderer.domElement.style.height = '100%';
      renderer.domElement.style.zIndex = '0';
      container.appendChild(renderer.domElement);

      const scene = new THREE.Scene();
      scene.fog = new THREE.FogExp2(0x05060a, 0.00085);

      const camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 3000);
      camera.position.set(0, 120, 420);

      const hemi = new THREE.HemisphereLight(0x9bbcff, 0x060618, 0.85);
      scene.add(hemi);

      const params = {
        count: 65000,
        arms: 4,
        radius: 600,
        randomness: 0.55,
        randomnessPower: 1.8,
        insideColor: new THREE.Color(0xfff0d8), // warm-ish core highlights
        outsideColor: new THREE.Color(0x5b3cff) // purple-blue outer
      };


      const geom = new THREE.BufferGeometry();
      const positions = new Float32Array(params.count * 3);
      const colors = new Float32Array(params.count * 3);
      const sizes = new Float32Array(params.count);

      for(let i=0;i<params.count;i++){
        const i3 = i*3;
        const r = Math.pow(Math.random(), 1.15) * params.radius;
        const spin = r * 0.12;
        const branch = i % params.arms;
        const branchAngle = (branch / params.arms) * Math.PI * 2;

        const randomX = Math.pow(Math.random(), params.randomnessPower) * (Math.random() < 0.5 ? 1 : -1) * params.randomness * r;
        const randomY = Math.pow(Math.random(), params.randomnessPower) * (Math.random() < 0.5 ? 1 : -1) * params.randomness * r * 0.28;
        const randomZ = Math.pow(Math.random(), params.randomnessPower) * (Math.random() < 0.5 ? 1 : -1) * params.randomness * r * 0.28;

        const angle = branchAngle + spin;

        positions[i3+0] = Math.cos(angle) * r + randomX;
        positions[i3+1] = randomY * 0.35;
        positions[i3+2] = Math.sin(angle) * r + randomZ * 0.25;

        const t = r / params.radius;
        const col = params.insideColor.clone().lerp(params.outsideColor, t * 0.92 + 0.03);
        colors[i3+0] = col.r;
        colors[i3+1] = col.g;
        colors[i3+2] = col.b;

        sizes[i] = 2.2 + Math.random() * 3.6 * (1 - t);
      }

      geom.setAttribute('position', new THREE.BufferAttribute(positions, 3));
      geom.setAttribute('color', new THREE.BufferAttribute(colors, 3));
      geom.setAttribute('size', new THREE.BufferAttribute(sizes, 1));


      const sprite = (function () {
        const c = document.createElement('canvas');
        c.width = 64; c.height = 64;
        const ctx = c.getContext('2d');
        const grad = ctx.createRadialGradient(32,32,2,32,32,32);
        grad.addColorStop(0, 'rgba(255,255,255,1)');
        grad.addColorStop(0.18, 'rgba(240,220,255,0.95)');
        grad.addColorStop(0.36, 'rgba(180,140,255,0.6)');
        grad.addColorStop(1, 'rgba(0,0,0,0)');
        ctx.fillStyle = grad;
        ctx.fillRect(0,0,64,64);
        return new THREE.CanvasTexture(c);
      })();

      const mat = new THREE.PointsMaterial({
        size: 6,
        vertexColors: true,
        map: sprite,
        transparent: true,
        depthWrite: false,
        blending: THREE.AdditiveBlending,
        sizeAttenuation: true
      });
      const galaxyPoints = new THREE.Points(geom, mat);
      scene.add(galaxyPoints);


      const coreGeom = new THREE.SphereBufferGeometry(18, 32, 32);
      const coreMat = new THREE.MeshBasicMaterial({ color: 0xffecb8, transparent:true, opacity:0.95, blending:THREE.AdditiveBlending });
      const core = new THREE.Mesh(coreGeom, coreMat);
      scene.add(core);


      const cloudGeom = new THREE.BufferGeometry();
      const cloudCount = 18000;
      const cloudPos = new Float32Array(cloudCount * 3);
      const cloudCol = new Float32Array(cloudCount * 3);
      for(let i=0;i<cloudCount;i++){
        const i3 = i*3;
        const rr = Math.random() * 90;
        const ang = Math.random() * Math.PI * 2;
        cloudPos[i3+0] = Math.cos(ang) * rr * (Math.random()*0.9);
        cloudPos[i3+1] = (Math.random()-0.5) * 30;
        cloudPos[i3+2] = Math.sin(ang) * rr * (Math.random()*0.9);
        const col = new THREE.Color().setHSL(0.7 + Math.random()*0.04, 0.6, 0.55 - Math.random()*0.18);
        cloudCol[i3+0] = col.r; cloudCol[i3+1] = col.g; cloudCol[i3+2] = col.b;
      }
      cloudGeom.setAttribute('position', new THREE.BufferAttribute(cloudPos, 3));
      cloudGeom.setAttribute('color', new THREE.BufferAttribute(cloudCol, 3));
      const cloudMat = new THREE.PointsMaterial({
        size: 18, map: sprite, transparent:true, blending:THREE.AdditiveBlending, depthWrite:false, vertexColors:true, opacity:0.36, sizeAttenuation:true
      });
      const cloudPoints = new THREE.Points(cloudGeom, cloudMat);
      scene.add(cloudPoints);


      const ringGeom = new THREE.RingBufferGeometry(220, 260, 512);
      const ringMat = new THREE.MeshBasicMaterial({ color:0x4d2aff, transparent:true, opacity:0.03, side:THREE.DoubleSide, blending:THREE.AdditiveBlending });
      const ring = new THREE.Mesh(ringGeom, ringMat);
      ring.rotation.x = Math.PI * 0.5;
      ring.position.y = -18;
      scene.add(ring);


      const fgCount = 520;
      const fgGeom = new THREE.BufferGeometry();
      const fgPos = new Float32Array(fgCount * 3);
      const fgCol = new Float32Array(fgCount * 3);
      for(let i=0;i<fgCount;i++){
        const i3 = i*3;

        fgPos[i3+0] = (Math.random() - 0.5) * 1200;
        fgPos[i3+1] = (Math.random() - 0.5) * 500;
        fgPos[i3+2] = -60 + Math.random() * 260;
        fgCol[i3+0] = 1.0; fgCol[i3+1] = 1.0; fgCol[i3+2] = 1.0;
      }
      fgGeom.setAttribute('position', new THREE.BufferAttribute(fgPos, 3));
      fgGeom.setAttribute('color', new THREE.BufferAttribute(fgCol, 3));
      const fgMat = new THREE.PointsMaterial({ size: 10, map: sprite, transparent:true, blending:THREE.AdditiveBlending, depthWrite:false, color:0xffffff, opacity:0.85, sizeAttenuation:true });
      const fgPoints = new THREE.Points(fgGeom, fgMat);
      scene.add(fgPoints);

      window.addEventListener('resize', onWindowResize);
      function onWindowResize(){ camera.aspect = window.innerWidth / window.innerHeight; camera.updateProjectionMatrix(); renderer.setSize(window.innerWidth, window.innerHeight); }

      let mouseX = 0, mouseY = 0;
      document.addEventListener('mousemove', (e)=>{ mouseX = (e.clientX / window.innerWidth) * 2 - 1; mouseY = (e.clientY / window.innerHeight) * 2 - 1; });

      const clock = new THREE.Clock();
      function animate(){
        const t = clock.getElapsedTime();
        galaxyPoints.rotation.y = t * 0.018;
        cloudPoints.rotation.y = -t * 0.008;
        ring.rotation.z = t * 0.0036;
        core.rotation.y = t * 0.02;

        const fgPositions = fgGeom.attributes.position.array;
        for(let i=0;i<fgCount;i++){
          const i3 = i*3;
          fgPositions[i3+1] += Math.sin(t*0.3 + i) * 0.002; 
          fgPositions[i3+0] += Math.cos(t*0.2 + i*0.7) * 0.02; 
          if(fgPositions[i3+2] > 260) fgPositions[i3+2] = -120;
        }
        fgGeom.attributes.position.needsUpdate = true;


        camera.position.x += (mouseX * 40 - camera.position.x) * 0.02;
        camera.position.y += (-mouseY * 30 + 20 - camera.position.y) * 0.02;
        camera.lookAt(0,0,0);

        renderer.render(scene, camera);
        requestAnimationFrame(animate);
      }
      animate();
      window._GALAXY = { renderer, scene, camera };
    })();

    const enterBtn = document.getElementById('enterBtn');
    const enterScreen = document.getElementById('enterScreen');
    const mainWrap = document.getElementById('mainWrap');
    const bgAudio = document.getElementById('bgAudio');
    const usernameEl = document.getElementById('username');
    const waveLayer = document.getElementById('waveLayer');
    const rotateOverlay = document.getElementById('rotateOverlay');
    const avatarImg = document.getElementById('avatarImg');

    const displayName = 'NguyenTrongg';
    const bioString = "Anh Trọng đẹp trai chim dài, còn em đóng vai người chồng bất lực nhìn vợ mình lên giường ứ ừ với anh Trọng|";

    function render3DName(text){
      usernameEl.innerHTML = '';
      const frag = document.createDocumentFragment();
      const arr = Array.from(text);
      arr.forEach((ch, idx) => {
        const span = document.createElement('span');
        span.className = 'letter';
        span.setAttribute('data-char', ch === ' ' ? '\u00A0' : ch);
        span.textContent = ch === ' ' ? '\u00A0' : ch;
        const delay = 80 * idx;
        span.style.animationDelay = `${delay}ms`;
        if(ch.trim() !== '' && Math.random() > 0.22) span.classList.add('float-anim');
        const tz = 20 + Math.floor(Math.random()*28);
        const rx = -6 + Math.random()*12;
        const ry = -6 + Math.random()*12;
        span.style.transform = `translateZ(${tz}px) rotateX(${rx}deg) rotateY(${ry}deg)`;
        frag.appendChild(span);
      });
      usernameEl.appendChild(frag);
      requestAnimationFrame(()=> {
        const letters = usernameEl.querySelectorAll('.letter');
        letters.forEach((l,i) => {
          setTimeout(()=> l.classList.add('in'), i*22);
        });
      });
    }

    function spawnWave(clientX, clientY){
      const el = document.createElement('div');
      el.className = 'wave';
      el.style.left = clientX + 'px';
      el.style.top = clientY + 'px';
      waveLayer.appendChild(el);
      el.addEventListener('animationend', ()=> el.remove());
    }

    let lastWaveAt = 0;
    document.addEventListener('mousemove', e => {
      const now = Date.now();
      if(now - lastWaveAt < 220) return;
      lastWaveAt = now;
      spawnWave(e.clientX, e.clientY);
      applyPointer3DEffect(e.clientX, e.clientY);
    });

    document.addEventListener('click', e => {
      const large = document.createElement('div');
      large.className = 'wave';
      large.style.width = '260px';
      large.style.height = '260px';
      large.style.left = e.clientX + 'px';
      large.style.top = e.clientY + 'px';
      large.style.animation = 'waveExpand 1100ms cubic-bezier(.2,.9,.3,1) forwards';
      large.style.filter = 'blur(6px) saturate(1.3)';
      waveLayer.appendChild(large);
      large.addEventListener('animationend', ()=> large.remove());
      spawnBurst(e.clientX, e.clientY);
    });

    function applyPointer3DEffect(cx, cy){
      const rect = usernameEl.getBoundingClientRect();
      if(rect.width === 0) return;
      const centerX = rect.left + rect.width/2;
      const centerY = rect.top + rect.height/2;
      const dx = (cx - centerX) / rect.width;
      const dy = (cy - centerY) / rect.height;
      usernameEl.style.transform = `perspective(900px) rotateX(${(-dy*6).toFixed(2)}deg) rotateY(${(dx*8).toFixed(2)}deg)`;
      const letters = usernameEl.querySelectorAll('.letter');
      letters.forEach((l, i) => {
        const offset = (i - letters.length/2) * 0.22;
        const tz = 18 + offset * 6 - dx*14;
        const rx = -4 + dy*8 + Math.sin(i*0.6)*2;
        const ry = dx*6 + Math.cos(i*0.4)*2;
        l.style.transform = `translateZ(${tz}px) rotateX(${rx.toFixed(2)}deg) rotateY(${ry.toFixed(2)}deg)`;
      });
    }

    document.addEventListener('mouseleave', () => {
      usernameEl.style.transform = '';
      const letters = usernameEl.querySelectorAll('.letter');
      letters.forEach((l) => { l.style.transform = l.style.transform.replace(/translateZ\([^)]+\)/,'translateZ(22px)'); });
    });

    function pulseAvatar(){
      const avatar = document.getElementById('avatar');
      avatar.style.transition = 'transform 220ms cubic-bezier(.2,.8,.2,1)';
      avatar.style.transform = 'scale(1.06)';
      setTimeout(()=> avatar.style.transform = 'scale(1)', 220);
    }

    const canvas = document.getElementById('avatar-canvas');
    const ctx = canvas.getContext('2d');
    let particles = [];
    const DPR = window.devicePixelRatio || 1;
    function resizeCanvas(){ canvas.width = canvas.clientWidth * DPR; canvas.height = canvas.clientHeight * DPR; }
    resizeCanvas();
    window.addEventListener('resize', resizeCanvas);

    function spawnParticle(x, y){
      const angle = Math.random()*Math.PI*2;
      const speed = 0.6 + Math.random()*2.4;
      particles.push({ x: x, y: y, vx: Math.cos(angle)*speed, vy: Math.sin(angle)*speed - 1.2, life: 60 + Math.random()*40, r: 1 + Math.random()*3, hue: 260 + Math.random()*60 });
      if(particles.length>220) particles.splice(0, particles.length-220);
    }

    function spawnBurst(clientX, clientY){
      const rect = canvas.getBoundingClientRect();
      const x = (clientX - rect.left) * DPR;
      const y = (clientY - rect.top) * DPR;
      for(let i=0;i<34;i++) spawnParticle(x, y);
    }

    setInterval(()=> {
      const rect = canvas.getBoundingClientRect();
      const cx = rect.width*DPR/2; const cy = rect.height*DPR/2;
      if(Math.random() < 0.6) spawnParticle(cx + (Math.random()-0.5)*40*DPR, cy + (Math.random()-0.5)*40*DPR);
    }, 160);

    function updateParticles(){
      ctx.clearRect(0,0,canvas.width,canvas.height);
      for(let i=particles.length-1;i>=0;i--){
        const p = particles[i];
        p.x += p.vx * DPR;
        p.y += p.vy * DPR;
        p.vy += 0.06 * DPR;
        p.life--;
        ctx.beginPath();
        const g = ctx.createRadialGradient(p.x, p.y, 0, p.x, p.y, p.r*6*DPR);
        g.addColorStop(0, `hsla(${p.hue},85%,65%,0.95)`);
        g.addColorStop(0.35, `hsla(${p.hue},85%,55%,0.45)`);
        g.addColorStop(1, `hsla(${p.hue},85%,45%,0)`);
        ctx.fillStyle = g;
        ctx.arc(p.x, p.y, p.r*DPR, 0, Math.PI*2);
        ctx.fill();
        if(p.life <= 0) particles.splice(i,1);
      }
      requestAnimationFrame(updateParticles);
    }
    requestAnimationFrame(updateParticles);

    let audioCtx, analyser, sourceNode;
    function initAudioReactive(){
      if(!window.AudioContext && !window.webkitAudioContext) return;
      audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      analyser = audioCtx.createAnalyser();
      analyser.fftSize = 256;
      const bufferLength = analyser.frequencyBinCount;
      const dataArray = new Uint8Array(bufferLength);
      try { sourceNode = audioCtx.createMediaElementSource(bgAudio); } catch(e) { console.warn('Cannot create media source: ', e); return; }
      sourceNode.connect(analyser);
      analyser.connect(audioCtx.destination);
      const bars = document.querySelectorAll('.eq .bar');
      function renderFrame(){
        analyser.getByteFrequencyData(dataArray);
        const step = Math.floor(dataArray.length / bars.length);
        for(let i=0;i<bars.length;i++){ const sum = dataArray[i*step] || 0; const h = Math.max(6, (sum / 255) * 100); bars[i].style.height = `${h}%`; bars[i].style.opacity = 0.6 + (h/200); }
        const bass = dataArray[2] + dataArray[3] + dataArray[4];
        const scale = 1 + Math.min(0.18, bass/800);
        document.querySelector('.avatar-ring').style.transform = `scale(${scale})`;
        requestAnimationFrame(renderFrame);
      }
      renderFrame();
    }

    const bioText = document.getElementById('bioText');
    function typewriterText(str, speed = 28){
      bioText.textContent = '';
      let i=0;
      function step(){ if(i < str.length){ bioText.textContent += str.charAt(i++); setTimeout(step, speed); } else { bioText.classList.add('visible'); } }
      setTimeout(step, 360);
    }

    function initialEntranceWave(){ const cx = window.innerWidth/2; const cy = window.innerHeight/2; spawnWave(cx, cy); setTimeout(()=> spawnWave(cx+120, cy-80), 160); setTimeout(()=> spawnWave(cx-160, cy+60), 320); }

    enterBtn.addEventListener('click', async () => {
      enterScreen.classList.add('exit');
      setTimeout(()=>{ enterScreen.style.display='none'; mainWrap.style.display='flex'; }, 800);
      setTimeout(initialEntranceWave, 240);
      try { await bgAudio.play(); fadeInAudio(bgAudio, 0.0, 0.9, 1800); initAudioReactive(); } catch (e) { console.log('Audio autoplay blocked', e); }
      render3DName(displayName);
      typewriterText(bioString, 28);
      spawnPersistentSparkles(80);
    });

    function fadeInAudio(audio, from, to, ms){ audio.volume = from; const step = (to - from) / (ms/60); const it = setInterval(()=>{ audio.volume = Math.min(to, audio.volume + step); if(audio.volume >= to) clearInterval(it); }, 60); }

    const avatarWrap = document.getElementById('avatarWrap');
    avatarWrap.addEventListener('mousemove', (e) => {
      const rect = avatarWrap.getBoundingClientRect();
      const px = (e.clientX - rect.left) / rect.width;
      const py = (e.clientY - rect.top) / rect.height;
      const rx = (py - 0.5) * 12;
      const ry = (px - 0.5) * -18;
      avatarWrap.style.transform = `perspective(700px) rotateX(${rx}deg) rotateY(${ry}deg) scale(1.03)`;
      document.getElementById('avatar').style.filter = `brightness(${1 + Math.abs(px-0.5) * 0.12}) saturate(${1 + Math.abs(py-0.5) * 0.06})`;
    });
    avatarWrap.addEventListener('mouseleave', () => { avatarWrap.style.transform = 'perspective(700px) rotateX(0) rotateY(0) scale(1)'; document.getElementById('avatar').style.filter = 'brightness(1) saturate(1)'; });
    avatarWrap.addEventListener('click', (e) => { pulseAvatar(); spawnBurst(e.clientX, e.clientY); spawnWave(e.clientX, e.clientY); });

    (function attachSocialExplosions(){ const socials = document.querySelectorAll('.socials a.social'); socials.forEach(a => { a.addEventListener('click', function(ev){ ev.preventDefault(); const r = a.getBoundingClientRect(); const cx = r.left + r.width/2; const cy = r.top + r.height/2; spawnExplosionVisual(cx, cy); a.style.transition = 'transform .22s ease'; a.style.transform = 'scale(0.95)'; setTimeout(()=> a.style.transform = '', 220); const href = a.href; setTimeout(()=> { try { window.open(href, '_blank', 'noopener'); } catch(e){ window.location.href = href; } }, 520); }); }); function spawnExplosionVisual(x, y){ const count = 20; for (let i=0;i<count;i++){ const el = document.createElement('div'); el.className = 'sparkle'; const size = Math.random()*8 + 4; el.style.width = el.style.height = size + 'px'; el.style.left = x + 'px'; el.style.top = y + 'px'; el.style.opacity = 1; document.body.appendChild(el); const angle = Math.random()*Math.PI*2; const dist = 40 + Math.random()*160; const dx = Math.cos(angle)*dist; const dy = Math.sin(angle)*dist - (Math.random()*40); el.animate([ { transform: 'translate(0,0) scale(1)', opacity: 1 }, { transform: `translate(${dx}px, ${dy}px) scale(0.3)`, opacity: 0 } ], { duration: 600 + Math.random()*700, easing: 'cubic-bezier(.2,.9,.3,1)' }); setTimeout(()=> el.remove(), 1300); } } })();

    function spawnExplosion(x, y) { for (let i = 0; i < 20; i++) { const p = document.createElement("div"); p.classList.add("sparkle"); p.style.width = p.style.height = Math.random() * 6 + 4 + "px"; p.style.left = x + "px"; p.style.top = y + "px"; p.style.background = "white"; document.body.appendChild(p); setTimeout(() => p.remove(), 2000); } }
    function spawnBurst(clientX, clientY){ const rect = canvas.getBoundingClientRect(); const x = (clientX - rect.left) * DPR; const y = (clientY - rect.top) * DPR; for(let i=0;i<26;i++) spawnParticle(x, y); }

    let sparkleInterval;
    function spawnPersistentSparkles(n = 30){ if(sparkleInterval) clearInterval(sparkleInterval); for(let i=0;i<n;i++) createFloatingSparkle(); sparkleInterval = setInterval(()=> { createFloatingSparkle(); }, 600); }
    function createFloatingSparkle(){ const el = document.createElement('div'); el.className = 'sparkle'; const size = Math.random()*4 + 3; el.style.width = el.style.height = size + 'px'; el.style.left = Math.random()*window.innerWidth + 'px'; el.style.top = Math.random()*window.innerHeight + 'px'; el.style.opacity = 0; el.style.background = 'linear-gradient(180deg, rgba(255,255,255,1), rgba(220,240,255,0.9))'; el.style.boxShadow = '0 0 10px rgba(255,255,255,0.9)'; document.body.appendChild(el); const dx = (Math.random()*200 - 100); const dy = (Math.random()*140 - 70); const dur = 1800 + Math.random()*2200; el.animate([ { opacity: 0, transform: 'translate(0,0) scale(0.8)' }, { opacity: 0.9, transform: `translate(${dx/3}px, ${dy/3}px) scale(1)` }, { opacity: 0, transform: `translate(${dx}px, ${dy}px) scale(0.6)` } ], { duration: dur, easing: 'linear', fill: 'forwards' }); setTimeout(()=> el.remove(), dur + 90); }

    function checkOrientationOverlay(){ const isPortrait = window.matchMedia('(orientation: portrait)').matches && window.innerWidth < 900; if(isPortrait){ rotateOverlay.style.display = 'flex'; } else { rotateOverlay.style.display = 'none'; } }
    window.addEventListener('resize', checkOrientationOverlay);
    window.addEventListener('orientationchange', checkOrientationOverlay);
    checkOrientationOverlay();

    (function protectShortcuts(){ document.addEventListener('contextmenu', function(e){ e.preventDefault(); }); document.addEventListener('keydown', function(e){ if (e.key === 'F12') { e.preventDefault(); return; } if (e.ctrlKey && e.shiftKey && (e.key === 'I' || e.key === 'i' || e.key === 'J' || e.key === 'j' || e.key === 'C' || e.key === 'c')) { e.preventDefault(); return; } if (e.ctrlKey && (e.key === 'U' || e.key === 'u' || e.key === 'S' || e.key === 's')) { e.preventDefault(); return; } }, {capture:true}); })();

    (function attachEnterEffects(){ const enter = document.getElementById('enterBtn'); enter.addEventListener('click', function(){ setTimeout(()=> spawnBlueWave(window.innerWidth/2, window.innerHeight/2), 280); setTimeout(()=> spawnBlueWave(window.innerWidth/2 + 140, window.innerHeight/2 - 80), 420); setTimeout(()=> spawnBlueWave(window.innerWidth/2 - 160, window.innerHeight/2 + 60), 620); }); function spawnBlueWave(cx, cy){ const el = document.createElement('div'); el.className = 'wave'; el.style.background = 'radial-gradient(circle, rgba(255,255,255,0.95), rgba(200,200,255,0.38) 40%, rgba(200,200,255,0.12) 60%, transparent 75%)'; el.style.left = cx + 'px'; el.style.top = cy + 'px'; el.style.filter = 'blur(6px) saturate(1.05)'; el.style.boxShadow = '0 30px 80px rgba(200,200,255,0.08)'; waveLayer.appendChild(el); el.addEventListener('animationend', ()=> el.remove()); } })();

    window.setVipProfile = function({name, bio, avatarPath}){ if(name) { render3DName(name); document.getElementById('username').setAttribute('data-shadow', name); } if(bio) { typewriterText(bio, 24); } if(avatarPath) { document.querySelector('#avatar img').src = avatarPath; } };

    render3DName(displayName);
    window.addEventListener('load', ()=> { setTimeout(()=> spawnBurst(canvas.getBoundingClientRect().left + canvas.width/2, canvas.getBoundingClientRect().top + canvas.height/2), 1200); setTimeout(initialEntranceWave, 800); });
  </script>


<script>
function spawnWhiteStarAround(el, size=12){
  const rect = el.getBoundingClientRect();
  const star = document.createElement('div');
  star.className = 'big-star';
  const s = size + Math.random()*6;
  star.style.width = s+'px';
  star.style.height = s+'px';
  const angle = Math.random()*Math.PI*2;
  const radius = rect.width/2 + 10 + Math.random()*20;
  const x = rect.left + rect.width/2 + Math.cos(angle)*radius;
  const y = rect.top + rect.height/2 + Math.sin(angle)*radius;
  star.style.left = x+'px';
  star.style.top = y+'px';
  document.body.appendChild(star);
  setTimeout(()=> star.remove(), 2000);
}
setInterval(()=>{
  const username = document.getElementById('username');
  const avatar = document.getElementById('avatarWrap');
  if(username) spawnWhiteStarAround(username, 14);
  if(avatar) spawnWhiteStarAround(avatar, 16);
}, 300);
</script>

<script>

(function(){

  function spawnShootingStar(){
    const el = document.createElement('div');
    el.className = 'shooting-star';
    // start near top-right half, drift diagonally
    const startX = window.innerWidth * (0.2 + Math.random()*0.8);
    const startY = window.innerHeight * (0.05 + Math.random()*0.45);
    el.style.left = startX + 'px';
    el.style.top = startY + 'px';
    el.style.opacity = 0.9;
    document.body.appendChild(el);
    const dx = - (200 + Math.random()*800);
    const dy = (200 + Math.random()*400);
    el.animate([
      { transform: 'translate(0,0) rotate(-30deg)', opacity:1 },
      { transform: `translate(${dx}px, ${dy}px) rotate(-30deg)`, opacity:0 }
    ], { duration: 900 + Math.random()*1200, easing: 'linear' });
    setTimeout(()=> el.remove(), 2200);
  }
  setInterval(()=> { if(Math.random()<0.6) spawnShootingStar(); }, 2800);


  document.querySelectorAll('.social').forEach(s => {
    s.addEventListener('click', function(e){
      const after = this.querySelector(':after');
      // add active class to trigger pseudo-element animation
      this.classList.add('active');
      setTimeout(()=> this.classList.remove('active'), 700);
      // open link after short delay (keep existing behavior if href present)
      const href = this.getAttribute('href');
      if(href && href !== '#'){
        setTimeout(()=> { window.open(href, '_blank', 'noopener'); }, 420);
      }
    });
  });


  const audio = document.getElementById('bgAudio');
  let audioCtx, analyser, dataArr;
  function setupAudio(){
    try{
      audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      const src = audioCtx.createMediaElementSource(audio);
      analyser = audioCtx.createAnalyser();
      analyser.fftSize = 256;
      src.connect(analyser);
      analyser.connect(audioCtx.destination);
      dataArr = new Uint8Array(analyser.frequencyBinCount);
      tickAudio();
    }catch(e){ console.warn('Audio context not available', e); }
  }
  function tickAudio(){
    if(!analyser) return requestAnimationFrame(tickAudio);
    analyser.getByteFrequencyData(dataArr);

    let bass=0;
    for(let i=0;i<5;i++) bass += dataArr[i];
    const scale = 1 + Math.min(0.28, bass/900);
    const vis = document.querySelector('.avatar-visualizer');
    if(vis) vis.style.transform = `translate(-50%,-50%) scale(${scale})`;

    const letters = document.querySelectorAll('.username .letter');
    if(letters && letters.length){
      let mid = 0;
      for(let i=5;i<40 && i<dataArr.length;i++) mid += dataArr[i];
      mid = mid / 35;
      letters.forEach((el, idx)=>{
        const intensity = Math.min(1, (mid/120) + Math.random()*0.06);
        el.style.textShadow = `0 ${6*intensity}px ${12*intensity}px rgba(155,92,255,${0.35*intensity}), 0 ${18*intensity}px ${40*intensity}px rgba(0,0,0,0.5)`;
        el.style.transform = `translateZ(${22 + intensity*12}px) scale(${1 + intensity*0.02})`;
      });
    }
    requestAnimationFrame(tickAudio);
  }

  if(audio){ audio.addEventListener('play', ()=> {
    try{ if(!audioCtx) setupAudio(); }catch(e){}
  }); }


  function confettiBurstAt(x,y){
    for(let i=0;i<36;i++){
      const c = document.createElement('div');
      c.style.position='fixed';
      c.style.left = x+'px'; c.style.top = y+'px';
      const s = 4 + Math.random()*8;
      c.style.width = s+'px'; c.style.height = s+'px';
      c.style.borderRadius = (Math.random()>0.5?'50%':'2px');
      c.style.background = `hsl(${Math.random()*360},80%,60%)`;
      c.style.zIndex = 9999;
      document.body.appendChild(c);
      const dx = (Math.random()-0.5)*300;
      const dy = -80 - Math.random()*180;
      const ang = Math.random()*360;
      c.animate([{transform:'translate(0,0) rotate(0deg)', opacity:1},{transform:`translate(${dx}px,${dy}px) rotate(${ang}deg)`, opacity:0}], { duration: 900 + Math.random()*700, easing:'cubic-bezier(.2,.9,.3,1)' });
      setTimeout(()=> c.remove(), 1700);
    }
  }


  if(window.render3DName && typeof window.render3DName === 'function'){
    const original = window.render3DName.bind(window);
    window.render3DName = function(name){
      original(name);

      const el = document.getElementById('username');
      if(el){
        const r = el.getBoundingClientRect();
        confettiBurstAt(r.left + r.width/2, r.top + r.height/2);
      }
    };
  } else {

    const usernameEl = document.getElementById('username');
    if(usernameEl){ usernameEl.textContent = 'NguyenTrongg VIP'; confettiBurstAt(usernameEl.getBoundingClientRect().left + 30, usernameEl.getBoundingClientRect().top + 6); }
  }


  let lastMouse = {x:0,y:0};
  document.addEventListener('mousemove', function(e){
    lastMouse.x = e.clientX; lastMouse.y = e.clientY;

    const wrap = document.querySelector('.wrap');
    if(wrap){
      const cx = window.innerWidth/2, cy = window.innerHeight/2;
      const dx = (e.clientX - cx) / cx;
      const dy = (e.clientY - cy) / cy;
      wrap.style.transform = `perspective(900px) rotateX(${(-dy*4).toFixed(2)}deg) rotateY(${(dx*6).toFixed(2)}deg)`;
    }
  });

})()



(function(){
  const audio = document.getElementById('bgAudio');
  let audioCtx, analyser, dataArr;
  function setupAudio(){
    try{
      audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      const src = audioCtx.createMediaElementSource(audio);
      analyser = audioCtx.createAnalyser();
      analyser.fftSize = 256;
      src.connect(analyser);
      analyser.connect(audioCtx.destination);
      dataArr = new Uint8Array(analyser.frequencyBinCount);
      tickSync();
    }catch(e){ console.warn('Audio context not available', e); }
  }
  function tickSync(){
    if(!analyser) return requestAnimationFrame(tickSync);
    analyser.getByteFrequencyData(dataArr);
    let bass = 0;
    for(let i=0;i<5;i++) bass += dataArr[i];
    const intensity = Math.min(1, bass/800);
    document.querySelector('.avatar-ring').style.boxShadow = 
      `0 0 ${20+intensity*20}px rgba(179,136,255,0.6),
       0 0 ${40+intensity*20}px rgba(0,234,255,0.4)`;
    document.querySelector('.card').style.boxShadow = 
      `0 12px ${40+intensity*30}px rgba(179,136,255,0.25),
       0 6px ${20+intensity*20}px rgba(0,234,255,0.2)`;
    document.querySelectorAll('.social').forEach(el=>{
      el.style.boxShadow = 
        `0 0 ${12+intensity*10}px rgba(179,136,255,0.4),
         0 0 ${24+intensity*12}px rgba(0,234,255,0.3)`;
    });
    requestAnimationFrame(tickSync);
  }
  if(audio){ audio.addEventListener('play', ()=> { if(!audioCtx) setupAudio(); }); }
})();
</script></body>
</html>
